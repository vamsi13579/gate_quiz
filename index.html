<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GATE CN Quiz (Live)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; max-width: 900px; margin: 24px auto; padding: 0 20px; }
    h1 { font-size: 1.6rem; margin-bottom: 6px; }
    .meta { color: #555; margin-bottom: 16px; }
    .q { border: 1px solid #eee; padding: 14px; margin-bottom: 12px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.03); }
    .q h3 { margin:0 0 8px 0; font-size:1rem; }
    .options { margin-left: 12px; }
    .match-grid { display:flex; gap:24px; }
    .left, .right { flex:1 }

    .slide { display: none; }
    .slide.active { display: block; }

    .nav-buttons {
      margin-top: 16px;
      text-align: center;
    }

    .nav-buttons button {
      padding: 8px 16px;
      margin: 0 8px;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
    }

    .nav-buttons button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <h1>GATE — Computer Networks: Live Quiz</h1>
  <div class="meta">
    <span id="timestamp"></span>
  </div>

  <div id="quiz"></div>

<script>
async function fetchQuestions() {
  try {
    const resp = await fetch('questions.json?t=' + Date.now());
    if (!resp.ok) throw new Error(resp.status);
    const data = await resp.json();
    renderQuiz(data);
  } catch (err) {
    document.getElementById('quiz').innerHTML =
      '<div class="q">Error loading questions</div>';
  }
}

function renderQuiz(data) {
  const quiz = document.getElementById('quiz');
  quiz.innerHTML = '';

  document.getElementById('timestamp').innerText =
    data.generated_at ? 'Generated: ' + new Date(data.generated_at).toLocaleString() : '';

  if (!data.questions || !data.questions.length) {
    quiz.innerHTML = '<div class="q">No questions available.</div>';
    return;
  }

  data.questions.forEach((q, idx) => {
    const container = document.createElement('div');
    container.className = 'q slide';
    if (idx === 0) container.classList.add('active');

    const header = document.createElement('h3');
    header.innerText = `Q${idx+1} (${q.type}, ${q.difficulty}) — ${q.topic || ''}`;
    container.appendChild(header);

    const questionText = document.createElement('div');
    questionText.innerHTML = q.text.replace(/\n/g, '<br>');
    container.appendChild(questionText);

    /* MCQ / MSQ */
    if (q.type === 'MCQ' || q.type === 'MSQ') {
      const opts = document.createElement('div');
      opts.className = 'options';

      q.options.forEach((opt, i) => {
        const label = document.createElement('label');
        label.style.display = 'block';

        const input = document.createElement('input');
        input.type = q.type === 'MCQ' ? 'radio' : 'checkbox';
        input.name = q.id;

        label.appendChild(input);
        label.append(' ' + opt);
        opts.appendChild(label);
      });

      container.appendChild(opts);
    }

    /* NAT */
    else if (q.type === 'NAT') {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Enter answer';
      input.style.width = '80%';
      input.style.marginTop = '8px';
      container.appendChild(input);
    }

    /* MATCH */
    else if (q.type === 'MATCH') {
      const grid = document.createElement('div');
      grid.className = 'match-grid';

      const left = document.createElement('ol');
      q.left.forEach(x => left.appendChild(Object.assign(document.createElement('li'), { innerText: x })));

      const right = document.createElement('ol');
      q.right.forEach(x => right.appendChild(Object.assign(document.createElement('li'), { innerText: x })));

      grid.append(left, right);
      container.appendChild(grid);
    }

    /* STATEMENT */
    else if (q.type === 'STATEMENT') {
      const opts = document.createElement('div');
      opts.className = 'options';

      q.options.forEach(opt => {
        const label = document.createElement('label');
        label.style.display = 'block';

        const input = document.createElement('input');
        input.type = 'radio';
        input.name = q.id;

        label.appendChild(input);
        label.append(' ' + opt);
        opts.appendChild(label);
      });

      container.appendChild(opts);
    }

    quiz.appendChild(container);
  });

  /* Navigation */
  const nav = document.createElement('div');
  nav.className = 'nav-buttons';

  const prev = document.createElement('button');
  prev.innerText = 'Previous';
  prev.disabled = true;

  const next = document.createElement('button');
  next.innerText = 'Next';

  nav.append(prev, next);
  quiz.appendChild(nav);

  const slides = document.querySelectorAll('.slide');
  let current = 0;

  function show(i) {
    slides.forEach((s, idx) => s.classList.toggle('active', idx === i));
    prev.disabled = i === 0;
    next.disabled = i === slides.length - 1;
  }

  prev.onclick = () => { if (current > 0) show(--current); };
  next.onclick = () => { if (current < slides.length - 1) show(++current); };
}

fetchQuestions();
</script>
</body>
</html>

