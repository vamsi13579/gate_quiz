<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GATE CN Quiz (Live)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; max-width: 900px; margin: 24px auto; padding: 0 20px; }
    h1 { font-size: 1.6rem; margin-bottom: 6px; }
    .meta { color: #555; margin-bottom: 16px; }
    .q { border: 1px solid #eee; padding: 14px; margin-bottom: 12px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.03); }
    .q h3 { margin:0 0 8px 0; font-size:1rem; }
    .options { margin-left: 12px; }
    .btn { padding: 8px 12px; margin-right: 8px; cursor: pointer; }
    .small { font-size: 0.9rem; color: #666 }
    .match-grid { display:flex; gap:24px; }
    .left, .right { flex:1 }
  </style>
</head>
<body>

<h1>GATE — Computer Networks: Live Quiz</h1>
<div class="meta">
  <button id="refresh" class="btn">Refresh</button>
  <span id="timestamp" class="small"></span>
</div>

<div id="quiz"></div>

<script>
async function fetchQuestions() {
  try {
    const resp = await fetch('questions.json?t=' + Date.now());
    if (!resp.ok) throw new Error('Failed to load questions');
    const data = await resp.json();
    renderQuiz(data);
  } catch (err) {
    document.getElementById('quiz').innerHTML =
      `<div class="q">Error: ${err.message}</div>`;
  }
}

function renderQuiz(data) {
  const quiz = document.getElementById('quiz');
  quiz.innerHTML = '';

  document.getElementById('timestamp').innerText =
    data.generated_at ? 'Generated: ' + new Date(data.generated_at).toLocaleString() : '';

  if (!data.questions || !data.questions.length) {
    quiz.innerHTML = '<div class="q">No questions available.</div>';
    return;
  }

  data.questions.forEach((q, idx) => {
    const container = document.createElement('div');
    container.className = 'q';

    /* Header */
    const header = document.createElement('h3');
    header.innerText = `Q${idx + 1} (${q.type}, ${q.difficulty}) — ${q.topic || ''}`;
    container.appendChild(header);

    /* Question Text (ONLY ONCE) */
    const text = document.createElement('div');
    text.innerHTML = q.text.replace(/\n/g, '<br>');
    container.appendChild(text);

    /* Render by Type */
    if (q.type === 'MCQ' || q.type === 'MSQ' || q.type === 'STATEMENT') {

      if (q.options && q.options.length) {
        const opts = document.createElement('div');
        opts.className = 'options';

        q.options.forEach((opt, i) => {
          const label = document.createElement('label');
          label.style.display = 'block';

          const input = document.createElement('input');
          input.type = (q.type === 'MSQ') ? 'checkbox' : 'radio';
          input.name = q.id || `q${idx}`;

          label.appendChild(input);
          label.appendChild(document.createTextNode(' ' + opt));
          opts.appendChild(label);
        });

        container.appendChild(opts);

      } 

    } else if (q.type === 'NAT') {
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Enter numerical answer';
      input.style.width = '60%';
      container.appendChild(input);

    } else if (q.type === 'MATCH') {
      const grid = document.createElement('div');
      grid.className = 'match-grid';

      const left = document.createElement('ol');
      q.left.forEach(i => {
        const li = document.createElement('li');
        li.innerText = i;
        left.appendChild(li);
      });

      const right = document.createElement('ol');
      q.right.forEach(i => {
        const li = document.createElement('li');
        li.innerText = i;
        right.appendChild(li);
      });

      grid.appendChild(left);
      grid.appendChild(right);
      container.appendChild(grid);
    }

    quiz.appendChild(container);
  });
}

document.getElementById('refresh').addEventListener('click', fetchQuestions);
fetchQuestions();
</script>

</body>
</html>
