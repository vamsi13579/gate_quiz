<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GATE CN Quiz (Live)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; max-width: 900px; margin: 24px auto; padding: 0 20px; }
    h1 { font-size: 1.6rem; margin-bottom: 6px; }
    .meta { color: #555; margin-bottom: 16px; }
    .q { border: 1px solid #eee; padding: 14px; margin-bottom: 12px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.03); }
    .q h3 { margin:0 0 8px 0; font-size:1rem; }
    .options { margin-left: 12px; }
    .btn { padding: 8px 12px; margin-right: 8px; cursor: pointer; }
    .small { font-size: 0.9rem; color: #666 }
    .match-grid { display:flex; gap:24px; }
    .left, .right { flex:1 }
    pre { background:#f8f8f8; padding:8px; border-radius:6px; }
  </style>
</head>
<body>
  <h1>GATE — Computer Networks: Live Quiz</h1>
  <div class="meta">
    <button id="refresh" class="btn">Refresh</button>
    <span id="timestamp" class="small"></span>
  </div>
  <div id="quiz"></div>

  <script>
    async function fetchQuestions() {
      try {
        const resp = await fetch('questions.json?t=' + Date.now()); // cache-bust
        if (!resp.ok) throw new Error('Could not fetch questions.json: ' + resp.status);
        const data = await resp.json();
        renderQuiz(data);
      } catch (err) {
        document.getElementById('quiz').innerHTML = '<div class="q">Error loading questions: ' + err.message + '</div>';
      }
    }

    function renderQuiz(data) {
      const quiz = document.getElementById('quiz');
      quiz.innerHTML = '';
      document.getElementById('timestamp').innerText = data.generated_at ? 'Generated: ' + new Date(data.generated_at).toLocaleString() : '';

      if (!data.questions || !data.questions.length) {
        quiz.innerHTML = '<div class="q">No questions available.</div>';
        return;
      }

      data.questions.forEach((q, idx) => {
        const container = document.createElement('div');
        container.className = 'q';

        const header = document.createElement('h3');
        header.innerText = `Q${idx+1} (${q.type}, ${q.difficulty}) — ${q.topic || ''}`;
        container.appendChild(header);

        const p = document.createElement('div');
        p.innerHTML = q.text ? q.text.replace(/\n/g, '<br>') : '';
        container.appendChild(p);

        // different renderers by type
        if (q.type === 'MCQ' || q.type === 'MSQ') {
          const list = document.createElement('div');
          list.className = 'options';
          q.options && q.options.forEach((opt, i) => {
            const id = `${q.id || 'q'+idx}-opt-${i}`;
            const label = document.createElement('label');
            label.style.display = 'block';
            const input = document.createElement('input');
            input.type = (q.type === 'MCQ') ? 'radio' : 'checkbox';
            input.name = q.id || 'q'+idx;
            input.id = id;
            label.appendChild(input);
            const span = document.createElement('span');
            span.innerHTML = ' ' + opt;
            label.appendChild(span);
            list.appendChild(label);
          });
          container.appendChild(list);
        } else if (q.type === 'NAT') {
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = 'Answer: _______';
          input.style.width = '80%';
          input.style.marginTop = '8px';
          container.appendChild(input);
        } else if (q.type === 'MATCH') {
          // left / right columns
          const grid = document.createElement('div');
          grid.className = 'match-grid';
          const leftDiv = document.createElement('div'); leftDiv.className='left';
          const rightDiv = document.createElement('div'); rightDiv.className='right';
          const leftList = document.createElement('ol'); leftList.style.paddingLeft='20px';
          (q.left || []).forEach(li => {
            const liEl = document.createElement('li'); liEl.innerText = li; leftList.appendChild(liEl);
          });
          const rightList = document.createElement('ol'); rightList.style.paddingLeft='20px';
          (q.right || []).forEach(li => {
            const liEl = document.createElement('li'); liEl.innerText = li; rightList.appendChild(liEl);
          });
          leftDiv.appendChild(leftList); rightDiv.appendChild(rightList);
          grid.appendChild(leftDiv); grid.appendChild(rightDiv);
          container.appendChild(grid);
        } else if (q.type === 'STATEMENT') {
          // assertion-reason style or True/False
          const pre = document.createElement('pre');
          pre.innerText = q.text;
          container.appendChild(pre);
          const opts = document.createElement('div'); opts.className='options';
          ['True','False'].forEach(v => {
            const id = `${q.id||'q'+idx}-tf-${v}`;
            const label = document.createElement('label'); label.style.display='inline-block'; label.style.marginRight='12px';
            const input = document.createElement('input'); input.type='radio'; input.name = q.id || 'q'+idx; input.id=id;
            label.appendChild(input); label.appendChild(document.createTextNode(' ' + v));
            opts.appendChild(label);
          });
          container.appendChild(opts);
        }

        quiz.appendChild(container);
      });
    }

    document.getElementById('refresh').addEventListener('click', fetchQuestions);
    // optional: auto refresh every 60 seconds
    // setInterval(fetchQuestions, 60000);

    // initial load
    fetchQuestions();
  </script>
</body>
</html>
